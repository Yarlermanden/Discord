name: Build, push, and deploy

on: 
    push:
        branches:
            - main

env:
    REGISTRY: ghcr.io
    IMAGE_NAME: ${{ github.repository }}

jobs:
    build_and_push_frontend:
        name: Build and push frontend
        runs-on: ubuntu-latest
        steps:
            - name: checkout the repo
              uses: actions/checkout@v2

            - name: login to registry
              uses: docker/login-action@v1
              with:
                      registry: ${{ env.REGISTRY }}
                      username: ${{ github.actor }}
                      password: ${{ secrets.GIT_TOKEN }}

            - name: Extract metadata
              id: meta
              uses: docker/metadata-action@v3
              with:
                      images: ${{ env.REGISTRY }}/${{ env.IMAGE_NAME }}

            - name: Build and push to registry
              uses: docker/build-push-action@v2
              with:
                      context: ./frontend
                      push: true
                      tags: ${{ steps.meta.outputs.tags }}
                      labels: ${{ steps.meta.outputs.labels }}

                      # file: frontend/dockerfile
                      # context: ./frontend
                      # push: true
                      # tags: discordBot/frontend:latest
